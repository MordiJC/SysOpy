CC= gcc 
CFLAGS= --std=c11 -Wall -Wextra -fPIC -pedantic -Wall \
    -Wno-missing-braces -Wextra -Wno-missing-field-initializers -Wformat=2 \
    -Wswitch-default -Wswitch-enum -Wcast-align -Wpointer-arith \
    -Wbad-function-cast -Wstrict-overflow=5 -Wstrict-prototypes -Winline \
    -Wundef -Wnested-externs -Wcast-qual -Wshadow -Wunreachable-code \
    -Wlogical-op -Wfloat-equal -Wstrict-aliasing=2 -Wredundant-decls \
    -Wold-style-definition -Werror \
    -fno-omit-frame-pointer -ffloat-store -fno-common -fstrict-aliasing
RM= rm -r 
AR= ar rcu 

STATIC_LIB=libblockarray.a
DYNAMIC_LIB=libblockarray.so
MAIN_EXEC= main

LIB_O= block_array.o
MAIN_O= main.o

all: $(STATIC_LIB) $(DYNAMIC_LIB) $(MAIN_EXEC) $(MAIN_EXEC)_dynamic $(MAIN_EXEC)_runtime

clean:
	$(RM) $(STATIC_LIB) $(DYNAMIC_LIB) ./*.o $(MAIN_EXEC)_static $(MAIN_EXEC)_dynamic $(MAIN_EXEC)_runtime

$(STATIC_LIB): $(LIB_O)
	$(AR) $@ $?

$(DYNAMIC_LIB): $(LIB_O)
	$(CC) $(CFLAGS) -c block_array.c -o block_array.o
	$(CC) $? -shared -o $@

$(MAIN_EXEC): $(MAIN_O) $(STATIC_LIB) 
	$(CC) $? -o $@_static

$(MAIN_EXEC)_static: $(MAIN_EXEC)

$(MAIN_EXEC)_dynamic: $(DYNAMIC_LIB)
	$(CC) $(MAIN_O) $(DYNAMIC_LIB) -o $@

$(MAIN_EXEC)_runtime: $(DYNAMIC_LIB)
	$(CC) $(MAIN_O) -o $@ -DLOAD_LIBRARY_AT_RUNTIME

depend:
	@$(CC) $(CFLAGS) -MM *.c

# Generated by `depend'

block_array.o: block_array.c block_array.h
main.o: main.c block_array.h