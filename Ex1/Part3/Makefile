CC= gcc 
CFLAGS= --std=c11 -Wall -Wextra -fPIC -pedantic -Wall \
    -Wno-missing-braces -Wextra -Wno-missing-field-initializers -Wformat=2 \
    -Wswitch-default -Wswitch-enum -Wcast-align -Wpointer-arith \
    -Wbad-function-cast -Wstrict-overflow=5 -Wstrict-prototypes -Winline \
    -Wundef -Wnested-externs -Wcast-qual -Wshadow -Wunreachable-code \
    -Wlogical-op -Wfloat-equal -Wstrict-aliasing=2 -Wredundant-decls \
    -Wold-style-definition -Werror \
    -fno-omit-frame-pointer -ffloat-store -fno-common -fstrict-aliasing
RM= rm -r 
AR= ar rcu 
RANLIB= ranlib

LIBS= -lm 

STATIC_LIB= libblockarray.a
DYNAMIC_LIB= libblockarray.so
MAIN_EXEC= main

LIB_O= block_array.o
MAIN_O= main.o

all: $(STATIC_LIB) $(DYNAMIC_LIB) $(MAIN_EXEC)

clean:
	$(RM) $(STATIC_LIB) $(DYNAMIC_LIB) ./*.o $(MAIN_EXEC)

$(STATIC_LIB): $(LIB_O)
	$(CC) $(CFLAGS) block_array.c -o block_array.o
	$(AR) $@ $?
	$(RANLIB) $@

$(DYNAMIC_LIB): $(LIB_O)
	$(CC) $(CFLAGS) block_array.c -o block_array.o -DCOMPILE_DYNAMIC
	$(CC) $? -shared -o $@ -D

$(MAIN_EXEC): $(STATIC_LIB) $(MAIN_O)
	$(CC) $? -o $@ -L . -l :$(STATIC_LIB)

$(MAIN_EXEC)_static: $(MAIN_EXEC)

$(MAIN_EXEC)_dynamic: $(DYNAMIC_LIB) $(MAIN_O)
	$(CC) $? -o $@ -L . -l :$(DYNAMIC_LIB)

$(MAIN_EXEC)_runtime: $(DYNAMIC_LIB) $(MAIN_O)
$(CC) $? -o $@ -DLOAD_LIBRARY_AT_RUNTIME

depend:
	@$(CC) $(CFLAGS) -MM *.c

# Generated by `depend'

block_array.o: block_array.c block_array.h config.h
main.o: main.c block_array.h config.h